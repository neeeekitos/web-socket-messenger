{"ast":null,"code":"import _toConsumableArray from \"/Users/nikita/Projects/insa/web-socket-messenger/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/nikita/Projects/insa/web-socket-messenger/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/nikita/Projects/insa/web-socket-messenger/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/nikita/Projects/insa/web-socket-messenger/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/nikita/Projects/insa/web-socket-messenger/frontend/src/components/MessageList/index.js\";\nimport React, { useEffect, useState } from 'react';\nimport Compose from '../Compose';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton';\nimport Message from '../Message';\nimport moment from 'moment';\nimport './MessageList.css';\nimport axios from \"axios\";\nvar MY_USER_ID = 'apple';\nexport default function MessageList(props) {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      chatId = _useState4[0],\n      setChatId = _useState4[1];\n\n  useEffect(\n  /*#__PURE__*/\n  _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return fetchMessages();\n\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  })), []);\n\n  var fetchMessages =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var response, messages;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log('fetching messages...');\n              _context2.next = 3;\n              return axios.get(\"http://localhost:8081/messages/getMessagesByChatId?chatId=\".concat(chatId));\n\n            case 3:\n              response = _context2.sent;\n              messages = Object.values(response.data).map(function (message) {\n                return {\n                  id: message.id,\n                  author: message.sender.username,\n                  message: message.text,\n                  timestamp: new Date(message.time)\n                };\n              });\n              setMessages(messages);\n              console.log(messages);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    return function fetchMessages() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var getMessages = function getMessages() {\n    var tempMessages = [{\n      id: 1,\n      author: 'apple',\n      message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n      timestamp: new Date().getTime()\n    }, {\n      id: 2,\n      author: 'orange',\n      message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n      timestamp: new Date().getTime()\n    }, {\n      id: 3,\n      author: 'orange',\n      message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n      timestamp: new Date().getTime()\n    }, {\n      id: 4,\n      author: 'apple',\n      message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n      timestamp: new Date().getTime()\n    }, {\n      id: 5,\n      author: 'apple',\n      message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n      timestamp: new Date().getTime()\n    }, {\n      id: 6,\n      author: 'apple',\n      message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n      timestamp: new Date().getTime()\n    }, {\n      id: 7,\n      author: 'orange',\n      message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n      timestamp: new Date().getTime()\n    }, {\n      id: 8,\n      author: 'orange',\n      message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n      timestamp: new Date().getTime()\n    }, {\n      id: 9,\n      author: 'apple',\n      message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n      timestamp: new Date().getTime()\n    }, {\n      id: 10,\n      author: 'orange',\n      message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n      timestamp: new Date().getTime()\n    }];\n    setMessages([].concat(_toConsumableArray(messages), tempMessages));\n  };\n\n  var renderMessages = function renderMessages() {\n    var i = 0;\n    var messageCount = messages.length;\n    var tempMessages = [];\n\n    while (i < messageCount) {\n      var previous = messages[i - 1];\n      var current = messages[i];\n      var next = messages[i + 1]; // let isMine = current.author === MY_USER_ID;\n\n      var isMine = true;\n      var currentMoment = moment(current.timestamp);\n      var prevBySameAuthor = false;\n      var nextBySameAuthor = false;\n      var startsSequence = true;\n      var endsSequence = true;\n      var showTimestamp = true;\n\n      if (previous) {\n        var previousMoment = moment(previous.timestamp);\n        var previousDuration = moment.duration(currentMoment.diff(previousMoment));\n        prevBySameAuthor = previous.author === current.author;\n\n        if (prevBySameAuthor && previousDuration.as('hours') < 1) {\n          startsSequence = false;\n        }\n\n        if (previousDuration.as('hours') < 1) {\n          showTimestamp = true;\n        }\n      }\n\n      if (next) {\n        var nextMoment = moment(next.timestamp);\n        var nextDuration = moment.duration(nextMoment.diff(currentMoment));\n        nextBySameAuthor = next.author === current.author;\n\n        if (nextBySameAuthor && nextDuration.as('hours') < 1) {\n          endsSequence = false;\n        }\n      }\n\n      tempMessages.push(React.createElement(Message, {\n        key: i,\n        isMine: isMine,\n        startsSequence: startsSequence,\n        endsSequence: endsSequence,\n        showTimestamp: showTimestamp,\n        data: current,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      })); // Proceed to the next message.\n\n      i += 1;\n    }\n\n    return tempMessages;\n  };\n\n  return React.createElement(\"div\", {\n    className: \"message-list\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(Toolbar, {\n    title: \"Conversation Title\",\n    rightItems: [React.createElement(ToolbarButton, {\n      key: \"info\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-information-circle-outline\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"video\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-videocam\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"phone\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-call\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    })],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"message-list-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, renderMessages()), React.createElement(Compose, {\n    rightItems: [React.createElement(ToolbarButton, {\n      key: \"photo\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-camera\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"image\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-image\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"audio\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-mic\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"money\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-card\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"games\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-logo-game-client.controller-b\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }), React.createElement(ToolbarButton, {\n      key: \"emoji\",\n      onClick: function onClick() {\n        return console.log(\"checkInfo\");\n      },\n      icon: \"ion-ios-happy\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    })],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }));\n}","map":{"version":3,"sources":["/Users/nikita/Projects/insa/web-socket-messenger/frontend/src/components/MessageList/index.js"],"names":["React","useEffect","useState","Compose","Toolbar","ToolbarButton","Message","moment","axios","MY_USER_ID","MessageList","props","messages","setMessages","chatId","setChatId","fetchMessages","console","log","get","response","Object","values","data","map","message","id","author","sender","username","text","timestamp","Date","time","getMessages","tempMessages","getTime","renderMessages","i","messageCount","length","previous","current","next","isMine","currentMoment","prevBySameAuthor","nextBySameAuthor","startsSequence","endsSequence","showTimestamp","previousMoment","previousDuration","duration","diff","as","nextMoment","nextDuration","push"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport Compose from '../Compose';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton';\nimport Message from '../Message';\nimport moment from 'moment';\n\nimport './MessageList.css';\nimport axios from \"axios\";\n\nconst MY_USER_ID = 'apple';\n\nexport default function MessageList(props) {\n  const [messages, setMessages] = useState([]);\n  const [chatId, setChatId] = useState(0);\n\n  useEffect(async () => {\n      await fetchMessages();\n  },[]);\n\n    const fetchMessages = async () => {\n        console.log('fetching messages...')\n        const response = await axios.get(`http://localhost:8081/messages/getMessagesByChatId?chatId=${chatId}`);\n        const messages = Object.values(response.data).map((message) => {\n            return {\n                id: message.id,\n                author: message.sender.username,\n                message: message.text,\n                timestamp: new Date(message.time)\n            }\n        })\n        setMessages(messages);\n        console.log(messages);\n  }\n\n  \n  const getMessages = () => {\n     var tempMessages = [\n        {\n          id: 1,\n          author: 'apple',\n          message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 2,\n          author: 'orange',\n          message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 3,\n          author: 'orange',\n          message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 4,\n          author: 'apple',\n          message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 5,\n          author: 'apple',\n          message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 6,\n          author: 'apple',\n          message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 7,\n          author: 'orange',\n          message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 8,\n          author: 'orange',\n          message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 9,\n          author: 'apple',\n          message: 'Hello world! This is a long message that will hopefully get wrapped by our message bubble component! We will see how well it works.',\n          timestamp: new Date().getTime()\n        },\n        {\n          id: 10,\n          author: 'orange',\n          message: 'It looks like it wraps exactly as it is supposed to. Lets see what a reply looks like!',\n          timestamp: new Date().getTime()\n        },\n      ]\n      setMessages([...messages, ...tempMessages])\n  }\n\n  const renderMessages = () => {\n    let i = 0;\n    let messageCount = messages.length;\n    let tempMessages = [];\n\n    while (i < messageCount) {\n      let previous = messages[i - 1];\n      let current = messages[i];\n      let next = messages[i + 1];\n      // let isMine = current.author === MY_USER_ID;\n      let isMine = true;\n      let currentMoment = moment(current.timestamp);\n      let prevBySameAuthor = false;\n      let nextBySameAuthor = false;\n      let startsSequence = true;\n      let endsSequence = true;\n      let showTimestamp = true;\n\n      if (previous) {\n        let previousMoment = moment(previous.timestamp);\n        let previousDuration = moment.duration(currentMoment.diff(previousMoment));\n        prevBySameAuthor = previous.author === current.author;\n        \n        if (prevBySameAuthor && previousDuration.as('hours') < 1) {\n          startsSequence = false;\n        }\n\n        if (previousDuration.as('hours') < 1) {\n          showTimestamp = true;\n        }\n      }\n\n      if (next) {\n        let nextMoment = moment(next.timestamp);\n        let nextDuration = moment.duration(nextMoment.diff(currentMoment));\n        nextBySameAuthor = next.author === current.author;\n\n        if (nextBySameAuthor && nextDuration.as('hours') < 1) {\n          endsSequence = false;\n        }\n      }\n\n      tempMessages.push(\n        <Message\n          key={i}\n          isMine={isMine}\n          startsSequence={startsSequence}\n          endsSequence={endsSequence}\n          showTimestamp={showTimestamp}\n          data={current}\n        />\n      );\n\n      // Proceed to the next message.\n      i += 1;\n    }\n\n    return tempMessages;\n  }\n\n    return(\n      <div className=\"message-list\">\n        <Toolbar\n          title=\"Conversation Title\"\n          rightItems={[\n            <ToolbarButton key=\"info\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-information-circle-outline\" />,\n            <ToolbarButton key=\"video\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-videocam\" />,\n            <ToolbarButton key=\"phone\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-call\" />\n          ]}\n        />\n\n        <div className=\"message-list-container\">{renderMessages()}</div>\n\n        <Compose rightItems={[\n          <ToolbarButton key=\"photo\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-camera\" />,\n          <ToolbarButton key=\"image\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-image\" />,\n          <ToolbarButton key=\"audio\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-mic\" />,\n          <ToolbarButton key=\"money\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-card\" />,\n          <ToolbarButton key=\"games\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-logo-game-client.controller-b\" />,\n          <ToolbarButton key=\"emoji\" onClick={() => console.log(\"checkInfo\")} icon=\"ion-ios-happy\" />\n        ]}/>\n      </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}